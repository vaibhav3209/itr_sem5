{% extends 'final/base_layout.html' %}

{% load static %}

{% block extra_css_files %}
<link rel="stylesheet" href="{% static 'final/css/student_dashboard.css' %}">
<link rel="stylesheet" href="{% static 'final/css/sidebar.css' %}">
<link rel="stylesheet" href="{% static 'final/css/main_content.css' %}">
<link rel="stylesheet" href="{% static 'final/css/table.css' %}">
{% endblock %}

{% block page_title %}Components Items{% endblock %}

{% block extra_js_files %}
<script src="{% static 'final/js/inv_items.js' %}"></script>
<script src="{% static 'final/js/filter_components.js' %}"></script>
<script src="{% static 'final/js/toggle_edit.js' %}"></script>
{% endblock %}

{% block page_content %}

<div class="dashboard-container">

    <aside class="sidebar">
        <h2>Admin Panel</h2>
        <ul>
            <li><a href="{% url 'final:admin_dashboard' %}">BACK TO DASHBOARD</a></li>
            <li><a href="{% url 'final:all_students' %}">All students</a></li>
            <li><a href="{% url 'final:approved' %}">Approved Requests</a></li>
            <li><a href="{% url 'final:inventory' %}">Inventory</a></li>
            <li>
                <form method="post" action="{% url 'final:admin_logout' %}">
                    {% csrf_token %}
                    <button type="submit" class="as-link">Logout</button>
                </form>
            </li>
        </ul>
    </aside>

    <main class="main-content">

        <section>

            <div class="search-bar">
                <input class='search-input' type="text" id="searchInput"
                       placeholder="Search component..."
                       onkeyup="filterComponents()">
            </div>

            <div class="category-block">
                {% if components %}
                <table>
                    <thead>
                    <tr>
                        <th>{{ category_name }}</th>
                        <th>Available</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                    </thead>

                    <tbody>
                    {% for item in components %}
                    <tr data-name="{{ item.comp_name }}">
                        <td>{{ item.comp_name }}</td>
                        <td>{{ item.comp_quantity_available }}</td>
                        <td>{{ item.comp_status }}</td>
                        <td>
                            <button onclick="toggleEdit('{{ item.id }}')">Edit</button>
                        </td>
                    </tr>


                    <!--EDIT ROW-->
                    <tr id="edit-row-{{ item.id }}" style="display:none;">
                        <td colspan="4">
                            <form method="POST">
                                {% csrf_token %}
                                <input type="hidden" name="component_id" value="{{ item.id }}">

                                <input type="text" name="comp_name" value="{{ item.comp_name }}">

                                <input type="number"
                                       id="qty-{{ item.id }}"
                                       name="comp_quantity"
                                       value="{{ item.comp_quantity_available }}"
                                       min="0">

                                <!-- Category -->
                                <select name="category_id">
                                    {% for cat in categories %}
                                    <option value="{{ cat.id }}" {% if cat.id == item.comp_category_id %}selected{% endif %}>
                                        {{ cat.comp_cate_category_name }}
                                    </option>
                                    {% endfor %}
                                </select>

                                <button type="submit" name="action" value="save">Save</button>
                                <button type="submit" name="action" value="delete">Mark Deleted
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="empty">No matching components found.</p>
            {% endif %}

        </section>
    </main>
</div>
{% endblock %}
