{% extends 'base_layout.html' %}

<!--css name-->
{% block css_filename %}student_dash/admin-dashboard.css{% endblock %}

<!--title  of webpage-->
{% block page_title %}welcome admin{% endblock %}

{% block page_content%}
  <div class="admin-container">
    <aside class="admin-sidebar">
      <h2>Admin Panel</h2>
      <ul>
          <li><a href="{% url 'dash:admindash' %}">BACK TO DASHBOARD</a></li>
        <li><a href="{% url 'dash:approved_requests' %}">Approved Requests</a></li>
        <li><a href="{% url 'dash:rejected_requests' %}">Rejected Requests</a></li>
        <li><a href="{% url 'dash:inventory_page' %}">Inventory</a></li>
<!--        <li><a href="project-tracker.html">Project Tracker</a></li>-->
        <li><a href="{% url 'dash:logout' %}">Logout</a></li>
      </ul>
    </aside>

    <main class="admin-main">
      <header>
        <h1>Welcome, Admin</h1>
        <h3>CURRENT REQUESTS</h3>
      </header>

{% comment "used to check this dicctionsry" %}
<pre>{{ grouped_requests.items }}</pre>
{% endcomment %}


        <section>
            {% if grouped_requests %}
{% for category, requests in grouped_requests.items %}

    <details open style="margin-bottom: 30px;">
        <summary style="font-weight: bold;">{{ category }}</summary>

        <table border="1" cellspacing="0" cellpadding="8" style="margin-top: 10px; width: 100%;">
            <thead>
                <tr>
                    <th>Student</th>
                    <th>Roll No.</th>
                    <th>Component</th>
                    <th>Quantity Issued</th>
                    <th>Currently Available</th>
                    <th>Form Date</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for req in requests %}
                <tr>
                    <td>{{ req.student__full_name }}</td>
                    <td>{{ req.student__roll_number }}</td>
                    <td>{{ req.component__name }}</td>
                    <td>{{ req.quantity_issued }}</td>
                    <td>{{ req.component__quantity }}</td>
                    <td>{{ req.form_date}}</td>
                  <td>
                    <form method="POST" action="{% url 'dash:update_status' %}">
      {% csrf_token %}
      <input type="hidden" name="roll_number" value="{{ req.student__roll_number }}">
      <input type="hidden" name="form_date" value="{{ req.form_date|date:'Y-m-d' }}">
      <input type="hidden" name="component_name" value="{{ req.component__name }}">

      <button name="action" value="approve">Approve</button>
      <button name="action" value="reject">Reject</button>
    </form>
                  </td>

                </tr>
                {% endfor %}
            </tbody>
        </table>
    </details>
{% endfor %}
            {% else %}
            <p class="empty">No current issues.</p>
        {% endif %}
        </section>
    </main>
  </div>
{% endblock %}
